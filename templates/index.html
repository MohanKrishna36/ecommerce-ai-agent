<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI SQL Assistant</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 2rem;
        }
        input, button {
            padding: 0.5rem;
            margin: 0.5rem 0;
            width: 100%;
        }
        pre {
            background: #f4f4f4;
            padding: 1rem;
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <h2>Ask Your Data</h2>
    <input id="question" type="text" placeholder="E.g. What is my total sales?" />
    <button onclick="askQuestion()">Ask</button>

    <h3>Generated SQL</h3>
    <pre id="sql"></pre>

    <h3>Results</h3>
    <pre id="results"></pre>

    <div id="chart" style="width:100%; max-width:700px; height:400px;"></div>

    <script>
        async function askQuestion() {
    const question = document.getElementById('question').value;
    const res = await fetch('/ask', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ question })
    });

    const data = await res.json();
    document.getElementById('sql').textContent = data.query || 'No SQL generated';

    if (data.results && Array.isArray(data.results) && data.results.length > 0) {
        document.getElementById('results').textContent = JSON.stringify(data.results, null, 2);

        const keys = Object.keys(data.results[0]);
        if (keys.length === 2) {
            const x = data.results.map(row => row[keys[0]]);
            const y = data.results.map(row => row[keys[1]]);
            Plotly.newPlot('chart', [{
                type: 'bar',
                x, y
            }], {
                title: `${keys[1]} by ${keys[0]}`,
                xaxis: { title: keys[0] },
                yaxis: { title: keys[1] }
            });
        } else {
            document.getElementById('chart').innerHTML = "<p>ℹ️ Chart needs exactly 2 columns in the result.</p>";
        }
    } else {
        document.getElementById('results').textContent = JSON.stringify(data, null, 2);
        document.getElementById('chart').innerHTML = "<p>⚠️ No data available to visualize.</p>";
    }
}

    </script>
</body>
</html>
